<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구구단 산성비 게임</title>
    
    <style>
        /* CSS 시작 */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            overflow: hidden; /* 구구단 문제가 밖으로 나가지 않도록 */
        }

        #game-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            padding: 30px;
            text-align: center;
            width: 90%;
            max-width: 600px;
            position: relative;
            overflow: hidden; /* 문제들이 컨테이너 밖으로 나가지 않게 */
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        #score-board {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #555;
        }

        #game-area {
            width: 100%;
            height: 300px; /* 게임 영역 높이 */
            border: 1px solid #ddd;
            background-color: #e9e9e9;
            position: relative;
            overflow: hidden; /* 내려오는 문제들이 이 영역 안에만 있도록 */
            margin-bottom: 20px;
        }

        .problem {
            position: absolute;
            top: 0;
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 1.5em;
            z-index: 10;
            white-space: nowrap; /* 문제가 줄바꿈되지 않도록 */
            min-width: 80px; /* 문제 텍스트 길이에 따라 너비가 너무 줄어들지 않도록 */
            text-align: center;
            box-sizing: border-box; /* padding이 너비에 포함되도록 */
        }

        #answer-input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 10px;
            font-size: 1.2em;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
        }

        #start-button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s ease;
        }

        #start-button:hover {
            background-color: #0056b3;
        }
        /* CSS 끝 */
    </style>
</head>
<body>
    <div id="game-container">
        <h1>구구단 산성비</h1>
        <div id="score-board">
            점수: <span id="score">0</span> | 생명: <span id="life">5</span>
        </div>
        <div id="game-area">
            <!-- 구구단 문제가 여기에 동적으로 생성됩니다 -->
        </div>
        <input type="text" id="answer-input" placeholder="정답을 입력하세요" autofocus>
        <button id="start-button">게임 시작</button>
    </div>

    <script>
        /* JavaScript 시작 */
        document.addEventListener('DOMContentLoaded', () => {
            const gameArea = document.getElementById('game-area');
            const answerInput = document.getElementById('answer-input');
            const scoreSpan = document.getElementById('score');
            const lifeSpan = document.getElementById('life');
            const startButton = document.getElementById('start-button');

            let score = 0;
            let life = 5;
            let problems = []; // 현재 화면에 보이는 문제들을 저장
            let gameInterval;
            let problemGenerationInterval;
            let gameRunning = false;

            // 게임 시작 함수
            function startGame() {
                if (gameRunning) return; // 이미 실행 중이면 중복 실행 방지
                gameRunning = true;
                score = 0;
                life = 5;
                scoreSpan.textContent = score;
                lifeSpan.textContent = life;
                gameArea.innerHTML = ''; // 기존 문제 제거
                problems = [];
                answerInput.value = '';
                answerInput.focus();
                startButton.disabled = true; // 게임 시작 버튼 비활성화

                // 문제 생성 주기 (처음엔 2초마다)
                problemGenerationInterval = setInterval(generateProblem, 2000);
                // 문제 내려오는 속도 및 충돌 감지 주기 (50ms마다)
                gameInterval = setInterval(gameLoop, 50); 
            }

            // 구구단 문제 생성 함수
            function generateProblem() {
                const num1 = Math.floor(Math.random() * 8) + 2; // 2단부터 9단까지
                const num2 = Math.floor(Math.random() * 9) + 1; // 1부터 9까지
                const problemText = `${num1} x ${num2}`;
                const answer = num1 * num2;

                const problemElement = document.createElement('div');
                problemElement.classList.add('problem');
                problemElement.textContent = problemText;
                problemElement.dataset.answer = answer; // 정답을 data- 속성으로 저장

                // 문제의 시작 X 위치를 랜덤으로 설정 (게임 영역 내에서)
                const gameAreaWidth = gameArea.offsetWidth;
                // 문제 요소의 너비를 얻어와서 정확한 랜덤 위치 계산
                // DOM에 추가되어야 너비를 알 수 있으므로, 임시로 추가 후 위치 설정
                gameArea.appendChild(problemElement); 
                const problemWidth = problemElement.offsetWidth;
                
                problemElement.style.left = `${Math.random() * (gameAreaWidth - problemWidth - 10)}px`; // 여백 고려
                problemElement.style.top = '0px'; // 항상 상단에서 시작

                problems.push(problemElement);
            }

            // 게임 루프 (문제 이동 및 충돌 감지)
            function gameLoop() {
                if (!gameRunning) return;

                // 역순으로 순회하여 배열 요소 제거 시 인덱스 문제 방지
                for (let i = problems.length - 1; i >= 0; i--) {
                    const problem = problems[i];
                    let currentTop = parseInt(problem.style.top);
                    let newTop = currentTop + 2; // 픽셀 단위로 아래로 이동 (속도 조절 가능)
                    problem.style.top = `${newTop}px`;

                    // 문제 요소가 게임 영역 하단에 도달했는지 확인
                    if (newTop + problem.offsetHeight > gameArea.offsetHeight) {
                        // 게임 영역 밖으로 나가면 생명 감소
                        life--;
                        lifeSpan.textContent = life;
                        problem.remove(); // 화면에서 문제 제거
                        problems.splice(i, 1); // 배열에서도 제거

                        if (life <= 0) {
                            endGame();
                            return; // 게임 종료 시 더 이상 루프를 진행하지 않음
                        }
                    }
                }
            }

            // 정답 입력 처리
            answerInput.addEventListener('keydown', (e) => {
                if (!gameRunning) return;
                if (e.key === 'Enter') {
                    const userAnswer = parseInt(answerInput.value.trim());
                    let found = false;

                    // 역순으로 순회하여 배열 요소 제거 시 인덱스 문제 방지
                    for (let i = problems.length - 1; i >= 0; i--) {
                        const problem = problems[i];
                        const correctAnswer = parseInt(problem.dataset.answer);

                        if (userAnswer === correctAnswer) {
                            score++;
                            scoreSpan.textContent = score;
                            problem.remove(); // 정답 맞추면 화면에서 제거
                            problems.splice(i, 1); // 배열에서도 제거
                            found = true;
                            break; // 하나만 맞추면 되므로 루프 종료
                        }
                    }

                    if (!found && !isNaN(userAnswer)) { // 정답을 못 찾았고, 유효한 숫자를 입력했으면 (오답 처리)
                        // 오답 시 생명 감소 등의 페널티를 추가할 수 있습니다.
                        // life--;
                        // lifeSpan.textContent = life;
                        // if (life <= 0) {
                        //     endGame();
                        // }
                    }
                    answerInput.value = ''; // 입력창 비우기
                }
            });

            // 게임 종료 함수
            function endGame() {
                gameRunning = false;
                clearInterval(gameInterval);
                clearInterval(problemGenerationInterval);
                alert(`게임 종료! 최종 점수: ${score}`);
                startButton.disabled = false; // 게임 시작 버튼 다시 활성화
            }

            startButton.addEventListener('click', startGame);
        });
        /* JavaScript 끝 */
    </script>
</body>
</html>